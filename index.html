<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BeatRush</title>
  <style>
    body { font-family: Arial; background: #f5f5f5; text-align: center; margin: 0; padding: 20px; }
    input[type="text"] { width: 80%; padding: 10px; margin: 10px; font-size: 16px; border-radius: 10px; border: 1px solid #ccc; background: rgba(255,255,255,0.8); }
    .button-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 10px 0; }
    button {
      padding: 15px 20px; border: none; border-radius: 15px; font-weight: bold;
      background: rgba(255,255,255,0.8); cursor: pointer; box-shadow: 5px 5px 10px rgba(0,0,0,0.2);
      transition: all 0.2s ease; position: relative;
    }
    button:hover { background: white; }
    button:active { transform: scale(0.95); box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2); }
    button.active-play { background-color: #d0f5d0 !important; border: 2px solid green; }
    .checkmark {
      position: absolute; top: -10px; right: -10px; background: green; color: white;
      border-radius: 50%; width: 20px; height: 20px; font-size: 14px; line-height: 20px;
    }
    #qr-button { background: #4CAF50; color: white; }
    #loadButton { background: orange; color: white; }
    #stopButton { background: #999; color: white; }
    #shameButton { background: crimson; color: white; }
    #qr-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center;
      align-items: center; flex-direction: column;
    }
    #qr-reader { width: 90%; max-width: 400px; }
    #scan-instruction { color: white; margin-bottom: 20px; font-size: 18px; }
    .close-btn {
      position: absolute; top: 10px; right: 15px; font-size: 30px; color: white;
      background: none; border: none; cursor: pointer;
    }
    #target-square { border: 4px solid white; width: 250px; height: 250px; position: absolute; }
    #player-container {
      position: relative; width: 320px; height: 180px; margin: 20px auto;
      overflow: hidden; background: rgba(255,255,255,0.8); border-radius: 10px;
    }
    #player iframe, #audioPlayer, #videoPlayer { width: 100%; height: 100%; }
    #overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      backdrop-filter: blur(10px); background: rgba(0,0,0,0.4); z-index: 10;
    }
    #progress-bar {
      width: 80%; height: 10px; background: #ccc; border-radius: 5px;
      overflow: hidden; margin: 20px auto; background: rgba(255,255,255,0.8);
    }
    #progress { width: 0%; height: 100%; background: #4CAF50; transition: width 0.1s linear; }
    #songInfo { margin-top: 15px; font-size: 18px; color: #333; font-weight: bold; }
    #qrMessage { margin-top: 10px; color: crimson; font-weight: bold; font-size: 16px; }
  </style>
</head>
<body>
  <button id="qr-button" onclick="openQRScanner()">ðŸ“· QR kÃ³d beolvasÃ¡sa</button>
  <div id="qr-overlay">
    <button class="close-btn" onclick="closeQRScanner()">âœ–</button>
    <div id="scan-instruction">Olvasd be a QR kÃ³dot:</div>
    <div id="target-square"></div>
    <div id="qr-reader"></div>
  </div>

  <h1>ðŸŽ¶ BeatRush ðŸŽ¶</h1>
  <input type="text" id="youtubeLink" placeholder="Illeszd be a YouTube/MP3/MP4 linket...">
  <div id="qrMessage"></div>
  <button id="loadButton" onclick="loadVideo()">BetÃ¶ltÃ©s</button>

  <h3>ðŸŽµ 0 mÃ¡sodpercrÅ‘l indulÃ³ gombok:</h3>
  <div class="button-group">
    <button id="btn-0s-1" onclick="playSegmentRepeated(1, 0, 'btn-0s-1')">1 mp</button>
    <button id="btn-0s-3" onclick="playSegmentRepeated(3, 0, 'btn-0s-3')">3 mp</button>
    <button id="btn-0s-5" onclick="playSegmentRepeated(5, 0, 'btn-0s-5')">5 mp</button>
  </div>

  <h3>ðŸŽµ 15 mÃ¡sodpercrÅ‘l indulÃ³ gombok:</h3>
  <div class="button-group">
    <button id="btn-15s-1" onclick="playSegmentRepeated(1, 15, 'btn-15s-1')">1 mp</button>
    <button id="btn-15s-3" onclick="playSegmentRepeated(3, 15, 'btn-15s-3')">3 mp</button>
    <button id="btn-15s-5" onclick="playSegmentRepeated(5, 15, 'btn-15s-5')">5 mp</button>
    <button onclick="playFullTrack()">Full Track</button>
  </div>

  <button id="stopButton" onclick="resetAll()">ðŸ›‘ STOP / RESET</button>

  <div id="player-container">
    <div id="player"></div>
    <audio id="audioPlayer" controls style="display:none;"></audio>
    <video id="videoPlayer" controls style="display:none;"></video>
    <div id="overlay"></div>
  </div>

  <div id="progress-bar">
    <div id="progress"></div>
  </div>

  <button id="shameButton" onclick="shameMode()">SzÃ©gyen! ðŸ™ˆ</button>
  <div id="songInfo"></div>

  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    // Itt lenne a teljes mÅ±kÃ¶dÃ©si JS, beleÃ©rtve a QR -> loadVideo() Ã©s az Ã¼zenet kiÃ­rÃ¡sÃ¡t
    function openQRScanner() {
      navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
        .then(function() {
          document.getElementById('qr-overlay').style.display = "flex";
          qrScanner = new Html5Qrcode("qr-reader");
          qrScanner.start(
            { facingMode: "environment" },
            { fps: 10, qrbox: 250 },
            qrCodeMessage => {
              document.getElementById('youtubeLink').value = qrCodeMessage;
              loadVideo(); // automatikus betÃ¶ltÃ©s QR utÃ¡n
              document.getElementById('qrMessage').innerText = "ðŸŽ§ QR sikeresen beolvasva! VÃ¡lassz egy gombot a lejÃ¡tszÃ¡shoz!";
              closeQRScanner();
            },
            errorMessage => {
              console.log(`QR error: ${errorMessage}`);
            }
          ).catch(err => {
            console.error(`Kamera hiba: ${err}`);
          });
        })
        .catch(function(err) {
          alert("A kamera elÃ©rÃ©sÃ©hez engedÃ©ly szÃ¼ksÃ©ges!");
          console.error("getUserMedia hiba:", err);
        });
    }
    function closeQRScanner() {
      if (qrScanner) {
        qrScanner.stop().then(() => {
          qrScanner.clear();
          qrScanner = null;
          document.getElementById('qr-overlay').style.display = "none";
        });
      } else {
        document.getElementById('qr-overlay').style.display = "none";
      }
    }
  </script>
</body>
</html>
